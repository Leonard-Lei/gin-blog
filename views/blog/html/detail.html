<!doctype html>
{{define "blog/detail.html"}}
<html lang="zh">

	{{ template "top_header.html" .}}
	<style type="text/css">
		.send{
            width: 84px !important;
            float: right !important;
            height: 70px !important;
            line-height: 20px !important;
            padding: 0 !important;
            text-transform: uppercase !important;
            color: #888 !important;
            background: #eee !important;
            border-radius: 4px !important;
		}
        .container {
            padding: 10px 0px;
        }

        .post {
            margin: 0 auto
        }
	</style>

	<body class="home blog custom-background round-avatars" itemscope itemtype="http://schema.org/Organization">

		{{ template "header.html" .}}

		<div id="main" class="content">
			<div class="container">
				<article id="post-1202" class="js-gallery post-1202 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized tag-11 tag-22 tag-29">
					<section class="post_content">
						<header class="post_header">
							<h1 class="post_title" id="title">title</h1>
						</header>
						<div class="post-body js-gallery">
							<p id="content"></p>
						</div>
						<div class="meta split split--responsive cf">
							<div class="split__title">
								<time datetime="" id="time"></time>
								<span class=""><a href="" rel="tag" id="tag">主题</a></span>
							</div>
							<div id="social-share"><span class="entypo-share"><i class="iconfont">&#xe614;</i>分享</span></div>
							<div class="slide">
								<a class="btn-slide" title="switch down"><i class="iconfont">&#xe615;</i>折叠评论区</a>
							</div>
						</div>
					</section>
				</article>
			</div>
			<svg id="go" width="100%" height="40" viewBox="0 0 100 102" preserveAspectRatio="none">
				<path d="M0 0 L50 100 L100 0 Z"></path>
			</svg>
			<div id="social">
				<ul>
					<li>
						<a href="" title="qzone" target="_blank"><i class="iconfont">&#xe67f;</i></a>
					</li>
					<li>
						<a href="" title="weibo" target="_blank"><i class="iconfont">&#xe680;</i></a>
					</li>
					<li>
						<a href="" title="douban" target="_blank"><i class="iconfont">&#xe681;</i></a>
					</li>
					<li>
						<a href="" title="twitter" target="_blank"><i class="iconfont">&#xe683;</i></a>
					</li>
				</ul>
			</div>
			<div id="panel">
				<div class="comment-area">
					<section class="comments">
						<div class="comments-main">
							<div id="comments-list-title"><span></span> 评论 </div>
							<div id="loading-comments">
								<div class="host">
									<div class="loading loading-0"></div>
									<div class="loading loading-1"></div>
									<div class="loading loading-2"></div>
								</div>
							</div>
							<ul  id="article_comment" class="commentwrap">
								<!-- #comment-## -->
							</ul>
							<nav id="comments-navi">
								<a class="prev page-numbers" href="">
									<</a>
										<a class='page-numbers' href="">1</a>
										<a class='page-numbers' href="">2</a>
										<a class='page-numbers' href="">3</a>
										<span aria-current='page' class='page-numbers current'>4</span></nav>
							<div id="respond" class="comment-respond">
								<h6 id="replytitle" class="comment-reply-title"><a rel="nofollow" id="cancel-comment-reply-link" href="" style="display:none;">取消</a></h6>
								<form action="#" method="post" id="commentform" class="clearfix">
									<div class="clearfix"></div>
									<div class="author-info">
										<input type="text" name="author" id="author" placeholder="昵  称 : " value="" tabindex="1" title="Name (required)" />
										<input type="text" name="email" id="email" placeholder="邮  箱 : " value="" tabindex="2" title="E-mail(will not be published) required" />
									</div>
									<div class="clearfix"></div>
									<input type='hidden' name='comment_post_ID' value='1202' id='comment_post_ID' />
									<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
									<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="632104fca1" /></p>
									<p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="87" /></p>
									<div class="comment-form-info">
										<div class="real-time-gravatar"> <img id="real-time-gravatar" src="/statics/blog/images/d41d8cd98f00b204e9800998ecf8427e.png" alt="gravatar头像" />
										</div>
										<p class="input-row">
											<i class="row-icon"></i>
											<textarea class="text_area" rows="3" cols="80" name="comment" id="comment" tabindex="4" placeholder="你不说两句吗？(°∀°)ﾉ……"></textarea>
											<input type="button" name="submit" class="button send" id="submit" tabindex="5" value="发送" />
										</p>
									</div>
								</form>
							</div>
						</div>
					</section>
				</div>
			</div>
			<svg id="dwTriangleColor" width="100%" height="40" viewBox="0 0 100 102" preserveAspectRatio="none">
				<path d="M0 0 L50 100 L100 0 Z"></path>
			</svg>
			<div class="wrapper">
			</div>
		</div>

		<div class="p-header">
			<figure class="p-image" style="background-image: url(/statics/blog/images/47fb3c_9afed6c259f94589881bd55376206366mv2_d_3840_5784_s_4_2.jpg);"></figure>
		</div>
		<div class="navpost-part">
			<div id="NextPrevPosts">
				<div id ="prev" class="prev" data-aos="slide-right" data-aos-delay="1.5s">
					<div class="arrow"><i class="iconfont">&#xe625;</i></div>
					<div class="preview">
						<div class="pull-left featuredImg" style="background-image:url('/statics/blog/images/nzn_qr.jpg');"></div>
						<a id="prevHref" class="pull-left preview-content bold" href="#"><span id="prevTitle">没有文章</span></a>
					</div>
				</div>
				<div id ="next" class="next" data-aos="slide-left" data-aos-delay="1.5s">
					<div class="arrow"><i class="iconfont">&#xe623;</i></div>
					<div class="preview">
						<div class="pull-right featuredImg" style="background-image:url('/statics/blog/images/hyl_qr.jpg');"></div>
						<a id="nextHref" class="pull-right preview-content bold" href="#"><span id="nextTitle">没有文章</span></a>
					</div>
				</div>
			</div>
		</div>

		{{ template "footer.html" .}}

		<script type="text/javascript">
			//获取url中参数
			function GetQueryString (name){
				var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
				var r = window.location.search.substr(1).match(reg);
				if(r!=null)return  unescape(r[2]); return null;
			}

			$("#submit").click(function () {
                var id = GetQueryString("id")
                var author = $("#author").val();
                var nickname = $("#author").val();
                var comment = $("#comment").val();
                var email = $("#email").val();

                var json ={
                    "ArticleID": parseInt(id),
                    "Content": comment,
                    "CreateBy": parseInt(author),
                    "Nickname": author,
                    "Email": email,
                    "State": 1
                }
                $.ajax({
                    type:"POST",
                    //请求的媒体类型
                    contentType: "application/json;charset=UTF-8",
                    //请求地址
                    url : "/api/v1/comments",
                    dataType:"json",
                    data : JSON.stringify(json),
                    //请求成功
                    success : function(result) {
                        var comment = $("#article_comment");
                        comment.append("<li class=\"comment even thread-even depth-1\" id=\"li-comment-\">\n" +
                                "<div id=\"comment-969\" class=\"comment_body contents\">\n" +
                                "<div class=\"profile\">\n" +
                                "<a href=\"\"><img src=\"/statics/blog/images/9cc50a9e422fb1c89aebafeb959cef7a.jpg\" class=\"gravatar\" alt=\"小布丁\"></a>\n" +
                                "</div>\n" +
                                "<div class=\"main shadow\">\n" +
                                "<div class=\"commentinfo\">\n" +
                                "<section class=\"commeta\">\n" +
                                "<div class=\"shang\">\n" +
                                "<h4 class=\"author\">"+json.Nickname+"</h4>\n" +
                                "</div>\n" +
                                "</section>\n" +
                                "</div>\n" +
                                "<div class=\"body\">\n" +
                                "<p>"+json.Content+"</p>\n" +
                                "</div>\n" +
                                "<div class=\"xia info\">\n" +
                                "<span><time datetime=\"2018-03-09\">2018年3月9日</time></span>\n" +
                                "<span><a rel='nofollow' class='comment-reply-link' href=\"\" onclick='return addComment.moveForm( \"comment-969\", \"969\", \"respond\", \"1202\" )' aria-label='回复给小布丁'>回复</a></span>\n" +
                                "</div>\n" +
                                "</div>\n" +
                                "</div>\n" +
                                "</li>")
                        alert("评论成功")

                    },
                    //请求失败，包含具体的错误信息
                    error : function(e){
                        console.log(e.status);
                        console.log(e.responseText);
                    }
                })
            })

			$(document).ready(function(){
				var token = localStorage.getItem("flyray_blog_token");
				var id = GetQueryString("id")
				$.ajax({
					type:"GET",
					//请求的媒体类型
					contentType: "application/json;charset=UTF-8",
					headers:{'token':token},
					//请求地址
					url : "/api/v1/articles/"+id,
					//请求成功
					success : function(result) {
						var item = result.data;
						$("#title").text(item.title);
                        var content = item.content.replace("<pre>","")
                        content = content.replace("</pre>","")
						$("#content").html(content);
						$("#title").text(item.title);
						$("#time").text(item.create_time);
                        $("#tag").text(item.tag.name);

					},
					//请求失败，包含具体的错误信息
					error : function(e){
						console.log(e.status);
						console.log(e.responseText);
					}
				})
				var preId = id - 1
                $.ajax({
                    type:"GET",
                    //请求的媒体类型
                    contentType: "application/json;charset=UTF-8",
                    headers:{'token':token},
                    //请求地址
                    url : "/api/v1/articles/"+preId,
                    //请求成功
                    success : function(result) {
                        var item = result.data;
                        $("#prevTitle").text(item.title);
                        $("#prevHref").attr('href','http://localhost:8000/blog/detail?id='+preId);
                    },
                    //请求失败，包含具体的错误信息
                    error : function(e){
                        console.log(e.status);
                        console.log(e.responseText);
                    }
                })
                var nextId = parseInt(id) + 1
                $.ajax({
                    type:"GET",
                    //请求的媒体类型
                    contentType: "application/json;charset=UTF-8",
                    headers:{'token':token},
                    //请求地址
                    url : "/api/v1/articles/"+nextId,
                    //请求成功
                    success : function(result) {
                        var item = result.data;
                        $("#nextTitle").text(item.title);
                        $("#nextHref").attr('href','http://localhost:8000/blog/detail?id='+nextId);

                    },
                    //请求失败，包含具体的错误信息
                    error : function(e){
                        console.log(e.status);
                        console.log(e.responseText);
                    }
                })
                //查询文章评论
                $.ajax({
                    type:"GET",
                    //请求的媒体类型
                    contentType: "application/json;charset=UTF-8",
                    headers:{'token':token},
                    //请求地址
                    url : "/api/v1/comments?state=1&page_num=-1&article_id="+parseInt(id),
                    //请求成功
                    success : function(result) {
                        var items = result.data.lists;
                        var comment = $("#article_comment");
                        for(i=0;i<items.length;i++){
                            comment.append("<li class=\"comment even thread-even depth-1\" id=\"li-comment-\">\n" +
                                    "<div id=\"comment-969\" class=\"comment_body contents\">\n" +
                                    "<div class=\"profile\">\n" +
                                    "<a href=\"\"><img src=\"/statics/blog/images/9cc50a9e422fb1c89aebafeb959cef7a.jpg\" class=\"gravatar\" alt=\""+items[i].nickname+"\"></a>\n" +
                                    "</div>\n" +
                                    "<div class=\"main shadow\">\n" +
                                    "<div class=\"commentinfo\">\n" +
                                    "<section class=\"commeta\">\n" +
                                    "<div class=\"shang\">\n" +
                                    "<h4 class=\"author\"><a href=\"\" target=\"_blank\"><img src=\"/statics/blog/images/9cc50a9e422fb1c89aebafeb959cef7a.jpg\" class=\"gravatarsmall\" alt=\"小布丁\">"+items[i].nickname+"</a></h4>\n" +
                                    "</div>\n" +
                                    "</section>\n" +
                                    "</div>\n" +
                                    "<div class=\"body\">\n" +
                                    "<p>"+items[i].content+"</p>\n" +
                                    "</div>\n" +
                                    "<div class=\"xia info\">\n" +
                                    "<span><time datetime=\"2018-03-09\">"+items[i].create_time+"</time></span>\n" +
                                    "<span><a rel='nofollow' class='comment-reply-link' href=\"\" onclick='return addComment.moveForm( \"comment-969\", \"969\", \"respond\", \"1202\" )' aria-label='回复给小布丁'>回复</a></span>\n" +
                                    "</div>\n" +
                                    "</div>\n" +
                                    "</div>\n" +
                                    "</li>")
                        }

                    },
                    //请求失败，包含具体的错误信息
                    error : function(e){
                        console.log(e.status);
                        console.log(e.responseText);
                    }
                })
			});
		</script>

	</body>

</html>
{{end}}